(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[669],{42699:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var a=n(19013),r=n(13882);function s(e,t){(0,r.Z)(2,arguments);var n=(0,a.Z)(e),s=(0,a.Z)(t);return n.getTime()>s.getTime()}},313:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var a=n(19013),r=n(13882);function s(e,t){(0,r.Z)(2,arguments);var n=(0,a.Z)(e),s=(0,a.Z)(t);return n.getTime()<s.getTime()}},3151:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var a=n(69119),r=n(13882);function s(e,t){(0,r.Z)(2,arguments);var n=(0,a.Z)(e),s=(0,a.Z)(t);return n.getTime()===s.getTime()}},4430:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/reports/retention",function(){return n(25506)}])},60684:function(e,t,n){"use strict";var a=n(85893),r=n(29120),s=n(99369);t.Z=function(e){let{message:t,children:n}=e;return(0,a.jsxs)(r.DL,{direction:"column",alignItems:"center",justifyContent:"center",gap:60,height:600,children:[(0,a.jsx)(r.JO,{size:"xl",children:(0,a.jsx)(s.Z,{})}),(0,a.jsx)(r.xv,{size:"lg",children:t}),(0,a.jsx)("div",{children:n})]})}},4647:function(e,t,n){"use strict";n.d(t,{Z:function(){return g}});var a=n(85893),r=n(67294),s=n(29120),i=n(10876),l=n(3151),c=n(42699),o=n(313),d=n(91998),u=n(95323),x=n(73865),h=n(44085),m=n(39030),v=n.n(m),j=function(e){let{startDate:t,endDate:n,minDate:i,maxDate:m,onChange:j,onClose:_}=e,[p,f]=(0,r.useState)((0,l.Z)(t,n)?x.Lx:x.B2),[g,Z]=(0,r.useState)(t),[b,y]=(0,r.useState)(t),[D,N]=(0,r.useState)(n),{locale:w}=(0,d.Z)(),{formatMessage:C,labels:T}=(0,h.Z)(),L=p===x.Lx?(0,c.Z)(i,g)&&(0,o.Z)(m,g):(0,c.Z)(b,D);return(0,a.jsxs)("div",{className:v().container,children:[(0,a.jsx)("div",{className:v().filter,children:(0,a.jsxs)(s.hE,{selectedKey:p,onSelect:f,children:[(0,a.jsx)(s.zx,{children:C(T.singleDay)},x.Lx),(0,a.jsx)(s.zx,{children:C(T.dateRange)},x.B2)]})}),(0,a.jsxs)("div",{className:v().calendars,children:[p===x.Lx&&(0,a.jsx)(s.f,{date:g,minDate:i,maxDate:m,onChange:Z}),p===x.B2&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.f,{date:b,minDate:i,maxDate:D,locale:(0,u.t4)(w),onChange:y}),(0,a.jsx)(s.f,{date:D,minDate:b,maxDate:m,locale:(0,u.t4)(w),onChange:N})]})]}),(0,a.jsxs)("div",{className:v().buttons,children:[(0,a.jsx)(s.zx,{variant:"primary",onClick:()=>{p===x.Lx?j("range:".concat(g.getTime(),":").concat(g.getTime())):j("range:".concat(b.getTime(),":").concat(D.getTime()))},disabled:L,children:C(T.save)}),(0,a.jsx)(s.zx,{onClick:_,children:C(T.cancel)})]})]})},_=n(91534),p=n(43756);let f=e=>{let{startDate:t,endDate:n,selectedUnit:r,onClick:i}=e,{locale:c}=(0,d.Z)(),o=1==+(null==r?void 0:r.num)&&(null==r?void 0:r.unit)==="month";return(0,a.jsxs)(s.DL,{gap:10,alignItems:"center",wrap:"nowrap",children:[(0,a.jsx)(s.JO,{className:"mr-2",onClick:function(e){e.stopPropagation(),i()},children:(0,a.jsx)(p.Z.Calendar,{})}),(0,a.jsx)(s.xv,{children:o?(0,a.jsx)(a.Fragment,{children:(0,_.p6)(t,"MMMM yyyy",c)}):(0,a.jsxs)(a.Fragment,{children:[(0,_.p6)(t,"d LLL y",c),!(0,l.Z)(t,n)&&" â€” ".concat((0,_.p6)(n,"d LLL y",c))]})})]})};var g=function(e){let{value:t,startDate:n,endDate:l,className:c,onChange:o,selectedUnit:d,showAllTime:u=!1,alignment:x="end"}=e,{formatMessage:m,labels:v}=(0,h.Z)(),[_,p]=(0,r.useState)(!1),g=[{label:m(v.today),value:"1day"},{label:m(v.lastHours,{x:24}),value:"24hour"},{label:m(v.yesterday),value:"-1day"},{label:m(v.thisWeek),value:"1week",divider:!0},{label:m(v.lastDays,{x:7}),value:"7day"},{label:m(v.thisMonth),value:"1month",divider:!0},{label:m(v.lastDays,{x:30}),value:"30day"},{label:m(v.lastDays,{x:90}),value:"90day"},{label:m(v.thisYear),value:"1year"},u&&{label:m(v.allTime),value:"all",divider:!0},{label:m(v.customRange),value:"custom",divider:!0}].filter(e=>e),Z=e=>{if("custom"===e){p(!0);return}o(e)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.Lt,{className:c,items:g,renderValue:e=>e.startsWith("range")?(0,a.jsx)(f,{startDate:n,endDate:l,selectedUnit:d,onClick:()=>Z("custom")}):g.find(t=>t.value===e).label,value:t,alignment:x,placeholder:m(v.selectDate),onChange:Z,children:e=>{let{label:t,value:n,divider:r}=e;return(0,a.jsx)(s.ck,{divider:r,children:t},n)}}),_&&(0,a.jsx)(s.u_,{onClose:()=>p(!1),children:(0,a.jsx)(j,{startDate:n,endDate:l,minDate:new Date(2e3,0,1),maxDate:(0,i.Z)(new Date),onChange:e=>{p(!1),o(e)},onClose:()=>p(!1)})})]})}},5390:function(e,t,n){"use strict";var a=n(85893),r=n(29120),s=n(4647),i=n(81031),l=n(91534),c=n(67294),o=n(89),d=n(24474);t.Z=function(e){let{showWebsiteSelect:t=!0,allowWebsiteSelect:n=!0,showDateSelect:u=!0,allowDateSelect:x=!0}=e,{report:h,updateReport:m}=(0,c.useContext)(o.GA),{formatMessage:v,labels:j}=(0,d.y_)(),{parameters:_}=h||{},{websiteId:p,dateRange:f}=_||{},{value:g,startDate:Z,endDate:b}=f||{};return(0,a.jsxs)(a.Fragment,{children:[t&&(0,a.jsx)(r.p7,{label:v(j.website),children:n&&(0,a.jsx)(i.Z,{websiteId:p,onSelect:e=>{m({websiteId:e,parameters:{websiteId:e}})}})}),u&&(0,a.jsx)(r.p7,{label:v(j.dateRange),children:x&&(0,a.jsx)(s.Z,{value:g,startDate:Z,endDate:b,onChange:e=>{m({parameters:{dateRange:{...(0,l.r0)(e)}}})}})})]})}},89:function(e,t,n){"use strict";n.d(t,{GA:function(){return o}});var a=n(85893),r=n(67294),s=n(70790),i=n(73057),l=n.n(i),c=n(24474);let o=(0,r.createContext)(null);t.ZP=function(e){let{reportId:t,defaultParameters:n,children:r,...i}=e,d=(0,c.nl)(t,n);return(0,a.jsx)(o.Provider,{value:{...d},children:(0,a.jsx)(s.Z,{...i,className:l().container,children:r})})}},60761:function(e,t,n){"use strict";var a=n(85893),r=n(73057),s=n.n(r);t.Z=function(e){let{children:t}=e;return(0,a.jsx)("div",{className:s().body,children:t})}},77406:function(e,t,n){"use strict";var a=n(85893),r=n(67294),s=n(11163),i=n(29120),l=n(56754),c=n(24474),o=n(89),d=n(13511),u=n.n(d),x=n(73057),h=n.n(x);t.Z=function(e){let{icon:t}=e,{report:n,updateReport:d}=(0,r.useContext)(o.GA),{formatMessage:x,labels:m,messages:v}=(0,c.y_)(),{showToast:j}=(0,i.e1)(),{post:_,useMutation:p}=(0,c.h_)(),f=(0,s.useRouter)(),{mutate:g,isLoading:Z}=p(e=>_("/reports",e)),{mutate:b,isLoading:y}=p(e=>_("/reports/".concat(e.id),e)),{name:D,description:N,parameters:w}=n||{},{websiteId:C,dateRange:T}=w||{},L=async()=>{n.id?b(n,{onSuccess:async()=>{j({message:x(v.saved),variant:"success"})}}):g(n,{onSuccess:async e=>{let{id:t}=e;j({message:x(v.saved),variant:"success"}),f.push("/reports/".concat(t),null,{shallow:!0})}})},R=e=>{d({name:e||"Untitled"})};return(0,a.jsxs)("div",{className:h().header,children:[(0,a.jsx)(l.Z,{title:(0,a.jsx)(()=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.JO,{size:"lg",children:t}),(0,a.jsx)(i.Df,{name:"name",value:D,placeholder:x(m.untitled),onCommit:R},D)]}),{}),children:(0,a.jsx)(i.fl,{variant:"primary",isLoading:Z||y,disabled:!C||!(null==T?void 0:T.value)||!D,onClick:L,children:x(m.save)})}),(0,a.jsx)("div",{className:u().description,children:(0,a.jsx)(i.Df,{name:"description",value:N,placeholder:"+ ".concat(x(m.addDescription)),onCommit:e=>{d({description:e})}},N)})]})}},8953:function(e,t,n){"use strict";var a=n(85893),r=n(73057),s=n.n(r);t.Z=function(e){let{children:t}=e;return(0,a.jsx)("div",{className:s().menu,children:t})}},63855:function(e,t,n){"use strict";n.d(t,{Z:function(){return R}});var a=n(85893),r=n(67294),s=n(94184),i=n.n(s),l=n(89),c=n(60684),o=n(24474),d=n(91534),u=n(14601),x=n.n(u),h=function(){let{formatMessage:e,labels:t}=(0,o.y_)(),{report:n}=(0,r.useContext)(l.GA),{data:s}=n||{};if(!s)return(0,a.jsx)(c.Z,{});let u=[1,2,3,4,5,6,7,14,21,28],h=s.reduce((e,t)=>{let{date:n,visitors:a,day:r}=t;return 0===r?e.concat({date:n,visitors:a,records:u.reduce((e,t)=>(e[t]=s.find(e=>e.date===n&&e.day===t),e),[]).filter(e=>e)}):e},[]),m=h.length;return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:x().table,children:[(0,a.jsxs)("div",{className:i()(x().row,x().header),children:[(0,a.jsx)("div",{className:x().date,children:e(t.date)}),(0,a.jsx)("div",{className:x().visitors,children:e(t.visitors)}),u.map(n=>(0,a.jsxs)("div",{className:x().day,children:[e(t.day)," ",n]},n))]}),h.map((e,t)=>{let{date:n,visitors:r,records:s}=e;return(0,a.jsxs)("div",{className:x().row,children:[(0,a.jsx)("div",{className:x().date,children:(0,d.p6)("".concat(n," 00:00:00"),"PP")}),(0,a.jsx)("div",{className:x().visitors,children:r}),u.map(e=>{var n;if(m-t<e)return null;let r=null===(n=s[e])||void 0===n?void 0:n.percentage;return(0,a.jsx)("div",{className:i()(x().cell,{[x().empty]:!r}),children:r?"".concat(r.toFixed(2),"%"):""},e)})]},t)})]})})},m=n(29120),v=n(43703),j=n(4135),_=n(43756),p=n(95323),f=n(61079),g=n.n(f);function Z(e){let{date:t=new Date,onChange:n}=e,{locale:s}=(0,o.bU)(),i=(0,d.p6)(t,"MMMM",s),l=t.getFullYear(),c=(0,r.useRef)(),u=(e,t)=>{n("range:".concat((0,v.Z)(t).getTime(),":").concat((0,j.Z)(t).getTime())),e()};return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{ref:c,className:g().container,children:[(0,a.jsxs)(m.qh,{children:[(0,a.jsxs)(m.zx,{className:g().input,variant:"quiet",children:[(0,a.jsx)(m.xv,{children:i}),(0,a.jsx)(m.JO,{size:"sm",children:(0,a.jsx)(_.Z.ChevronDown,{})})]}),(0,a.jsx)(m.GI,{className:g().popup,alignment:"start",children:e=>(0,a.jsx)(m.aO,{date:t,locale:(0,p.t4)(s),onSelect:u.bind(null,e)})})]}),(0,a.jsxs)(m.qh,{children:[(0,a.jsxs)(m.zx,{className:g().input,variant:"quiet",children:[(0,a.jsx)(m.xv,{children:l}),(0,a.jsx)(m.JO,{size:"sm",children:(0,a.jsx)(_.Z.ChevronDown,{})})]}),(0,a.jsx)(m.GI,{className:g().popup,alignment:"start",children:e=>(0,a.jsx)(m.wN,{date:t,locale:(0,p.t4)(s),onSelect:u.bind(null,e)})})]})]})})}var b=n(5390),y=function(){let{report:e,runReport:t,isRunning:n,updateReport:s}=(0,r.useContext)(l.GA),{formatMessage:i,labels:c}=(0,o.y_)(),u=(0,r.useRef)(null),{parameters:x}=e||{},{websiteId:h,dateRange:v}=x||{},{startDate:j}=v||{},_=!h||!v;return(0,a.jsxs)(m.l0,{ref:u,values:x,onSubmit:(e,n)=>{n.stopPropagation(),n.preventDefault(),_||t(e)},preventSubmit:!0,children:[(0,a.jsx)(b.Z,{showDateSelect:!1}),(0,a.jsx)(m.p7,{label:i(c.date),children:(0,a.jsx)(Z,{date:j,onChange:e=>{s({parameters:{dateRange:{...(0,d.r0)(e)}}})}})}),(0,a.jsx)(m.Au,{children:(0,a.jsx)(m.Mm,{variant:"primary",disabled:_,loading:n,children:i(c.runQuery)})})]})},D=n(77406),N=n(8953),w=n(60761),C=n(54073),T=n(73865);let L={type:T.H$.retention,parameters:{dateRange:(0,d.r0)("range:".concat((0,v.Z)(new Date).getTime(),":").concat((0,j.Z)(new Date).getTime()))}};function R(e){let{reportId:t}=e;return(0,a.jsxs)(l.ZP,{reportId:t,defaultParameters:L,children:[(0,a.jsx)(D.Z,{icon:(0,a.jsx)(C.Z,{})}),(0,a.jsx)(N.Z,{children:(0,a.jsx)(y,{})}),(0,a.jsx)(w.Z,{children:(0,a.jsx)(h,{})})]})}},25506:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return l}});var a=n(85893),r=n(16822),s=n(63855),i=n(44085);function l(){let{formatMessage:e,labels:t}=(0,i.Z)();return(0,a.jsx)(r.Z,{title:"".concat(e(t.retention)," - ").concat(e(t.reports)),children:(0,a.jsx)(s.Z,{})})}},61079:function(e){e.exports={container:"MonthSelect_container__VDgiJ",input:"MonthSelect_input__CIZdD",popup:"MonthSelect_popup__HxGKB"}},39030:function(e){e.exports={container:"DatePickerForm_container__MygMe",calendars:"DatePickerForm_calendars__wK_V1",filter:"DatePickerForm_filter__iM5CX",buttons:"DatePickerForm_buttons__j7UzK"}},13511:function(e){e.exports={description:"ReportHeader_description__kwiO0"}},73057:function(e){e.exports={container:"reports_container__vtdom",header:"reports_header__2wPzw",menu:"reports_menu__bzvzT",body:"reports_body__qSCo8"}},14601:function(e){e.exports={table:"RetentionTable_table__PWAXt",header:"RetentionTable_header__Q4_Vn",row:"RetentionTable_row__8BAUu",cell:"RetentionTable_cell__Vbo9B",date:"RetentionTable_date__UUWQ6",visitors:"RetentionTable_visitors__lt_uT",day:"RetentionTable_day__wPMhh",empty:"RetentionTable_empty__xZLU3"}}},function(e){e.O(0,[678,885,668,762,249,67,359,774,888,179],function(){return e(e.s=4430)}),_N_E=e.O()}]);