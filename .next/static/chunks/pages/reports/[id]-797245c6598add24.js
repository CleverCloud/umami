(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[193],{86768:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/reports/[id]",function(){return n(23694)}])},63855:function(e,t,n){"use strict";n.d(t,{Z:function(){return C}});var l=n(85893),r=n(67294),a=n(94184),s=n.n(a),i=n(89),d=n(60684),o=n(24474),c=n(91534),u=n(14601),x=n.n(u),m=function(){let{formatMessage:e,labels:t}=(0,o.y_)(),{report:n}=(0,r.useContext)(i.GA),{data:a}=n||{};if(!a)return(0,l.jsx)(d.Z,{});let u=[1,2,3,4,5,6,7,14,21,28],m=a.reduce((e,t)=>{let{date:n,visitors:l,day:r}=t;return 0===r?e.concat({date:n,visitors:l,records:u.reduce((e,t)=>(e[t]=a.find(e=>e.date===n&&e.day===t),e),[]).filter(e=>e)}):e},[]),p=m.length;return(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{className:x().table,children:[(0,l.jsxs)("div",{className:s()(x().row,x().header),children:[(0,l.jsx)("div",{className:x().date,children:e(t.date)}),(0,l.jsx)("div",{className:x().visitors,children:e(t.visitors)}),u.map(n=>(0,l.jsxs)("div",{className:x().day,children:[e(t.day)," ",n]},n))]}),m.map((e,t)=>{let{date:n,visitors:r,records:a}=e;return(0,l.jsxs)("div",{className:x().row,children:[(0,l.jsx)("div",{className:x().date,children:(0,c.p6)("".concat(n," 00:00:00"),"PP")}),(0,l.jsx)("div",{className:x().visitors,children:r}),u.map(e=>{var n;if(p-t<e)return null;let r=null===(n=a[e])||void 0===n?void 0:n.percentage;return(0,l.jsx)("div",{className:s()(x().cell,{[x().empty]:!r}),children:r?"".concat(r.toFixed(2),"%"):""},e)})]},t)})]})})},p=n(29120),j=n(43703),_=n(4135),h=n(43756),v=n(95323),f=n(61079),b=n.n(f);function g(e){let{date:t=new Date,onChange:n}=e,{locale:a}=(0,o.bU)(),s=(0,c.p6)(t,"MMMM",a),i=t.getFullYear(),d=(0,r.useRef)(),u=(e,t)=>{n("range:".concat((0,j.Z)(t).getTime(),":").concat((0,_.Z)(t).getTime())),e()};return(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{ref:d,className:b().container,children:[(0,l.jsxs)(p.qh,{children:[(0,l.jsxs)(p.zx,{className:b().input,variant:"quiet",children:[(0,l.jsx)(p.xv,{children:s}),(0,l.jsx)(p.JO,{size:"sm",children:(0,l.jsx)(h.Z.ChevronDown,{})})]}),(0,l.jsx)(p.GI,{className:b().popup,alignment:"start",children:e=>(0,l.jsx)(p.aO,{date:t,locale:(0,v.t4)(a),onSelect:u.bind(null,e)})})]}),(0,l.jsxs)(p.qh,{children:[(0,l.jsxs)(p.zx,{className:b().input,variant:"quiet",children:[(0,l.jsx)(p.xv,{children:i}),(0,l.jsx)(p.JO,{size:"sm",children:(0,l.jsx)(h.Z.ChevronDown,{})})]}),(0,l.jsx)(p.GI,{className:b().popup,alignment:"start",children:e=>(0,l.jsx)(p.wN,{date:t,locale:(0,v.t4)(a),onSelect:u.bind(null,e)})})]})]})})}var Z=n(5390),y=function(){let{report:e,runReport:t,isRunning:n,updateReport:a}=(0,r.useContext)(i.GA),{formatMessage:s,labels:d}=(0,o.y_)(),u=(0,r.useRef)(null),{parameters:x}=e||{},{websiteId:m,dateRange:j}=x||{},{startDate:_}=j||{},h=!m||!j;return(0,l.jsxs)(p.l0,{ref:u,values:x,onSubmit:(e,n)=>{n.stopPropagation(),n.preventDefault(),h||t(e)},preventSubmit:!0,children:[(0,l.jsx)(Z.Z,{showDateSelect:!1}),(0,l.jsx)(p.p7,{label:s(d.date),children:(0,l.jsx)(g,{date:_,onChange:e=>{a({parameters:{dateRange:{...(0,c.r0)(e)}}})}})}),(0,l.jsx)(p.Au,{children:(0,l.jsx)(p.Mm,{variant:"primary",disabled:h,loading:n,children:s(d.runQuery)})})]})},N=n(77406),w=n(8953),F=n(60761),A=n(54073),R=n(73865);let T={type:R.H$.retention,parameters:{dateRange:(0,c.r0)("range:".concat((0,j.Z)(new Date).getTime(),":").concat((0,_.Z)(new Date).getTime()))}};function C(e){let{reportId:t}=e;return(0,l.jsxs)(i.ZP,{reportId:t,defaultParameters:T,children:[(0,l.jsx)(N.Z,{icon:(0,l.jsx)(A.Z,{})}),(0,l.jsx)(w.Z,{children:(0,l.jsx)(y,{})}),(0,l.jsx)(F.Z,{children:(0,l.jsx)(m,{})})]})}},23694:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return G}});var l=n(85893),r=n(11163),a=n(16822),s=n(46856),i=n(89),d=n(77406),o=n(8953),c=n(60761),u=n(67294),x=n(24474),m=n(29120),p=n(98776),j=n(73865),_=n(43756),h=n(73935),v=n(61371),f=n(5799);function b(e){let{name:t,type:n,onSelect:r}=e,{formatMessage:a,labels:s}=(0,x.y_)(),i={number:[{label:a(s.sum),value:"sum"},{label:a(s.average),value:"average"},{label:a(s.min),value:"min"},{label:a(s.max),value:"max"}],date:[{label:a(s.min),value:"min"},{label:a(s.max),value:"max"}],string:[{label:a(s.total),value:"total"},{label:a(s.unique),value:"unique"}],uuid:[{label:a(s.total),value:"total"},{label:a(s.unique),value:"unique"}]},d=i[n];return(0,l.jsx)(m.l0,{children:(0,l.jsx)(m.p7,{label:t,children:(0,l.jsx)(m.v2,{onSelect:e=>{r({name:t,type:n,value:e})},children:d.map(e=>{let{label:t,value:n}=e;return(0,l.jsx)(m.ck,{children:t},n)})})})})}var g=n(14704),Z=n(84363),y=n.n(Z),N=function(e){let{fields:t=[],group:n,element:r,onAdd:a,onClose:s}=e,[i,d]=(0,u.useState)(),o=e=>{a(n,e),s()};return(0,h.createPortal)((0,l.jsxs)(v.Z,{className:y().popup,element:r,onClose:s,children:[!i&&(0,l.jsx)(f.Z,{fields:t,onSelect:e=>{let{type:t}=e;if(n===j.tv.groups||"array"===t||"boolean"===t){e.value=n===j.tv.groups?"":"total",o(e);return}d(e)}}),i&&n===j.tv.fields&&(0,l.jsx)(b,{...i,onSelect:o}),i&&n===j.tv.filters&&(0,l.jsx)(g.Z,{...i,onSelect:o})]}),document.body)},w=n(5390),F=n(54092),A=n(22138),R=n.n(A),T=function(){let{report:e,runReport:t,updateReport:n,isRunning:r}=(0,u.useContext)(i.GA),{formatMessage:a,labels:s,messages:d}=(0,x.y_)(),o=(0,u.useRef)(null),{parameters:c}=e||{},{websiteId:h,dateRange:v,fields:f,filters:b,groups:g}=c||{},{startDate:Z,endDate:y}=v||{},A=h&&v&&(null==f?void 0:f.length),{data:T,error:C}=function(e,t,n){let{get:l,useQuery:r}=(0,x.h_)(),{data:a,error:s,isLoading:i}=r(["fields",e,t,n],()=>l("/reports/event-data",{websiteId:e,startAt:+t,endAt:+n}),{enabled:!!(e&&t&&n)});return{data:a,error:s,isLoading:i}}(h,Z,y),P=h&&Z&&y,S=(null==T?void 0:T.length)!==0,D=[{label:a(s.fields),group:j.tv.fields},{label:a(s.filters),group:j.tv.filters}],q={fields:f,filters:b,groups:g},E=(e,t)=>{let l=q[e];l.find(e=>{let{name:n}=e;return n===t.name})||n({parameters:{[e]:l.concat(t)}})},M=(e,t)=>{let l=[...q[e]];l.splice(t,1),n({parameters:{[e]:l}})},G=e=>{let{group:t}=e;return(0,l.jsxs)(m.qh,{children:[(0,l.jsx)(m.JO,{children:(0,l.jsx)(_.Z.Plus,{})}),(0,l.jsx)(m.GI,{position:"bottom",alignment:"start",children:(e,n)=>(0,l.jsx)(N,{fields:T.map(e=>{let{eventKey:t,eventDataType:n}=e;return{name:t,type:j.D3[n]}}),group:t,element:n,onAdd:E,onClose:e})})]})};return(0,l.jsxs)(m.l0,{ref:o,values:c,error:C,onSubmit:e=>{t(e)},children:[(0,l.jsx)(w.Z,{}),!S&&(0,l.jsx)(p.Z,{message:a(d.noEventData)}),P&&S&&D.map(e=>{let{label:t,group:n}=e;return(0,l.jsx)(m.p7,{label:t,action:(0,l.jsx)(G,{group:n,onAdd:E}),children:(0,l.jsx)(F.Z,{items:q[n],onRemove:e=>M(n,e),children:e=>{let{name:t,value:r}=e;return(0,l.jsxs)("div",{className:R().parameter,children:[n===j.tv.fields&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{children:t}),(0,l.jsx)("div",{className:R().op,children:r})]}),n===j.tv.filters&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{children:t}),(0,l.jsx)("div",{className:R().op,children:r[0]}),(0,l.jsx)("div",{children:r[1]})]})]})}})},t)}),(0,l.jsx)(m.Au,{children:(0,l.jsx)(m.Mm,{variant:"primary",disabled:!A,loading:r,children:a(s.runQuery)})})]})},C=function(){let{report:e}=(0,u.useContext)(i.GA),{formatMessage:t,labels:n}=(0,x.y_)();return(0,l.jsxs)(m.R1,{data:(null==e?void 0:e.data)||[],children:[(0,l.jsx)(m.C4,{name:"field",label:t(n.field)}),(0,l.jsx)(m.C4,{name:"value",label:t(n.value)}),(0,l.jsx)(m.C4,{name:"total",label:t(n.total)})]})},P=n(85360);let S={type:"event-data",parameters:{fields:[],filters:[]}};var D=n(67354),q=n(63855);let E={funnel:s.Z,"event-data":function(e){let{reportId:t}=e;return(0,l.jsxs)(i.ZP,{reportId:t,defaultParameters:S,children:[(0,l.jsx)(d.Z,{icon:(0,l.jsx)(P.Z,{})}),(0,l.jsx)(o.Z,{children:(0,l.jsx)(T,{})}),(0,l.jsx)(c.Z,{children:(0,l.jsx)(C,{})})]})},insights:D.Z,retention:q.Z};function M(e){let{reportId:t,reportType:n}=e,r=E[n];return(0,l.jsx)(r,{reportId:t})}function G(){let{formatMessage:e,labels:t}=(0,x.y_)(),n=(0,r.useRouter)(),{id:s}=n.query,{get:i,useQuery:d}=(0,x.h_)(),{data:o}=d(["reports",s],()=>i("/reports/".concat(s)),{enabled:!!s});return s&&o?(0,l.jsx)(a.Z,{title:e(t.websites),children:(0,l.jsx)(M,{reportId:o.id,reportType:o.type})}):null}},61079:function(e){e.exports={container:"MonthSelect_container__VDgiJ",input:"MonthSelect_input__CIZdD",popup:"MonthSelect_popup__HxGKB"}},84363:function(e){e.exports={menu:"FieldAddForm_menu__EaLS8",item:"FieldAddForm_item__t1aaR",type:"FieldAddForm_type__F8KCl",selected:"FieldAddForm_selected__m9w7m",popup:"FieldAddForm_popup__8vTXp",filter:"FieldAddForm_filter__h6AoE",dropdown:"FieldAddForm_dropdown__ROn1D"}},22138:function(e){e.exports={parameter:"EventDataParameters_parameter__jT8lx",op:"EventDataParameters_op__XKUxH"}},14601:function(e){e.exports={table:"RetentionTable_table__PWAXt",header:"RetentionTable_header__Q4_Vn",row:"RetentionTable_row__8BAUu",cell:"RetentionTable_cell__Vbo9B",date:"RetentionTable_date__UUWQ6",visitors:"RetentionTable_visitors__lt_uT",day:"RetentionTable_day__wPMhh",empty:"RetentionTable_empty__xZLU3"}}},function(e){e.O(0,[678,885,668,762,249,664,67,359,451,856,354,774,888,179],function(){return e(e.s=86768)}),_N_E=e.O()}]);